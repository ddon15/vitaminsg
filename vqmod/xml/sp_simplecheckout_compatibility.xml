<modification>
    <id>Special Promotions compatibility mod for SimpleCheckout module</id>
    <version>1.0</version>
    <vqmver>1.2.3</vqmver>
    <author>Mal</author>
    <file name="catalog/controller/checkout/simplecheckout.php" error="skip">
        <operation error="skip">
            <search position="replace" index="1"><![CDATA[$this->response->setOutput($this->render());]]></search>
            <add><![CDATA[
            if ($this->config->get('special_promotions_key') &&
                $this->config->get('special_promotions_status') &&
                $this->config->get('special_promotions_dynamic_banners') &&
                !empty($this->data['ajax'])) {
                    $sp_render = $this->render();
                    if (isset($_SERVER['HTTPS']) && (($_SERVER['HTTPS'] == 'on') || ($_SERVER['HTTPS'] == '1'))) {
                        $sp_url = HTTPS_SERVER . 'index.php?route=module/special_promotions/banner';
                    } else {
                        $sp_url = HTTP_SERVER . 'index.php?route=module/special_promotions/banner';
                    }
                    $sp_render .= "<script type=\"text/javascript\"><!-- $('.special_banner_wrapper').each(function (i, e) { $(e).load('" . $sp_url . "&sp-banner=' + $(e).attr('data-banner') + '&sp-module=' + $(e).attr('data-module') + '&sp-route=' + $(e).attr('data-route') + '&sp-path=' + $(e).attr('data-path') + '&sp-manufacturer=' + $(e).attr('data-manufacturer') + '&sp-product=' + $(e).attr('data-product') + ' .special_banner_wrapper > *'); }); </script>";
                    $this->response->setOutput($sp_render);
            } else {
                $this->response->setOutput($this->render());
            }
            ]]></add>
        </operation>
    </file>
</modification>